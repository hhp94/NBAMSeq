---
title: "modding"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{modding}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

# Todo 
Simplify the `results1` and return function and possibly add `gamm`. But for now this is sufficient. Expect the function to still run very slowly because of the multiple steps and how each model is running 15k+ genes.

The current results function doesn't handle more complicated smooths. Also contrasting should be done at the fitting level. Needs to rewrite `results1`.

# Scratchpad
```{r setup}
library(devtools)
library(testthat)
library(microbenchmark)
library(mgcv)
load_all()
# styler::style_file("R/NBAMSeq1.R")
# styler::style_file("R/topTable1.R")

set.seed(1234)
sim1 <- makeExample(n = 20, m = 20)
sim1$id <- factor(seq_along(sim1$pheno))
sim1$f <- factor(rbinom(ncol(sim1), 1, 0.5)) 
sim1@design <- ~ f + s(pheno, by = f) + s(id, bs = "re")

sim_fit <- NBAMSeq1(sim1, joint_test = list("s(pheno, by = f)"))

topTable1(sim_fit, coef = "(Intercept)")

joint_results = "joint_results1"
```
